---
title: "GY476 2025 SUMMATIVE ASSESSMENT"
output:
  html_document: 
    toc: true
    toc_float: true
    theme: cosmo
    echo: false
---

## Introduction
This report examines Los Angeles through two datasets: Airbnb listings and the American Community Survey (ACS). As a popular tourist destination, LA experiences high demand for short-term rentals, which reduces the supply of houses on the market, creating a ‘rental gap’ where short-term rentals are more profitable than long-term ones, thereby inducing gentrification and pricing out locals (Wachsmuth and Weisler, 2018). Data compiled from Airbnb’s website includes listing information alongside other variables such as price. The ACS captures poverty rates, socioeconomic disparities, and wealth inequality, offering insights into Los Angeles’s high levels of inequality (Bohn and Thorman, 2025). This spatial analysis examines the distribution of Airbnb listings and their relationship to key socioeconomic variables through a rent gap lens, informing policy decisions aimed at addressing the housing crisis in Los Angeles and alleviating homelessness (Nowell, 2025; The Economist, 2025).


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, 
                      fig.align = 'center', fig.width = 12, fig.height = 8)

wdir <- "/Users/dylanhillier/Library/CloudStorage/OneDrive-LondonSchoolofEconomics/GY476_Geographic_Information_System/assessment02"
library(tidyverse); library(sf); library(tmap); library(tidycensus)
library(grid); library(osmdata); library(ggspatial); library(spatstat)

ddir <- file.path(wdir, "data")
if(!dir.exists(ddir)) dir.create(ddir)

api_key <- Sys.getenv("CENSUS_API_KEY")
if(api_key == "") stop("Census API key not found.")
census_api_key(api_key, install = TRUE, overwrite = TRUE)
```


```{r download-data, include=FALSE}
# Download data if not exists
urls <- list(
  listing = "https://data.insideairbnb.com/united-states/ca/los-angeles/2025-09-01/visualisations/listings.csv",
  neighbourhoods = "https://data.insideairbnb.com/united-states/ca/los-angeles/2025-09-01/visualisations/neighbourhoods.geojson"
)
for(f in names(urls)) {
  dest <- file.path(ddir, paste0(ifelse(f=="listing","listing.csv","neighbourhoods.geojson")))
  if(!file.exists(dest)) download.file(urls[[f]], dest)
}

# Load all data
airbnb_raw <- read.csv(file.path(ddir, "listing.csv"))
neighbourhoods_sf <- st_read(file.path(ddir, "neighbourhoods.geojson"), quiet=TRUE) %>% st_set_crs(4326) %>% st_transform(32611)
census_tracts_sf <- st_read(file.path(ddir, "LA_geometry.gpkg"), quiet=TRUE) %>% st_transform(32611) %>% st_make_valid()
census_data <- read.csv(file.path(ddir, "ACS_2019_2023_LA_vars.csv")) %>%
  mutate(GEOID = paste0("06", str_sub(as.character(GEOID), start = 2)))

# Bounding boxes
mainland_bbox <- st_bbox(c(xmin=320000, ymin=3710000, xmax=445000, ymax=3860000), crs=32611)
catalina_bbox <- st_bbox(c(xmin=340000, ymin=3678000, xmax=390000, ymax=3708000), crs=32611)
census_joined <- census_tracts_sf %>% left_join(census_data, by="GEOID")
```



```{r prepare-airbnb, include=FALSE}
Q1 <- quantile(airbnb_raw$price, 0.25, na.rm=TRUE)
Q3 <- quantile(airbnb_raw$price, 0.75, na.rm=TRUE)
IQR_val <- Q3 - Q1

airbnb_sf <- airbnb_raw %>%
  filter(price >= (Q1 - 1.5*IQR_val) & price <= (Q3 + 1.5*IQR_val)) %>%
  st_as_sf(coords = c("longitude", "latitude")) %>%
  st_set_crs(4326) %>% st_transform(32611) %>% st_make_valid()
```

# Section A
## Question 1
Airbnb data is publicly available and readily accessible via web scraping, providing a snapshot (specifically for September in Los Angeles) of Airbnb listings and prices in specific areas. The use of point-level geographic coordinates allows for spatial plotting alongside details like price, room type, availability, and reviews. It covers the entire LA metro area and Santa Catalina Island. However, there are limitations: it is not official Airbnb data but collated information. It also lacks key details such as actual booking prices (since it shows listed prices), fees or discounts, and private or unlisted properties. Additionally, it offers only a snapshot in time, neglecting seasonal variations common in Los Angeles. Lastly, since data is reported by hosts, there is a risk of unreliability or false information. 
Examining American Community Survey (ACS) data, it provides 5-year estimates (2019-2023) across various factors. While it has many strengths, such as being official government statistics offering detailed demographic, economic, and housing data, including a margin of error indicating uncertainty- it also has limitations.. However, 5-year averages can reduce reliability for current conditions. Since the data are aggregated at the tract level, we cannot observe smaller subdivisions, meaning tract averages do not reflect individual circumstances within each tract. Furthermore, as it is self-reported, it may include biases or inaccuracies from respondents. Listings with prices outside 1.5 × IQR from the quartiles were removed as outliers because they could misrepresent certain areas. Extremely high prices on rare luxury properties might not be typical of an area, potentially distorting visualisations and statistical summaries, and failing to accurately reflect the usual Airbnb markets. Finally, regarding the coordinate reference system (CRS), I have chosen UTM Zone 11N (EPSG:32611), since it uses metres, making measurements easier, covers all of Los Angeles with minimal distortion, and is well-suited for distance and area calculations. It is also commonly used in academic research. The reason WGS84 wasn’t used was partly because it is in degrees, which is less accurate for measuring distance.

## Question 2: Spatial Distribution of Airbnb Listings	


```{r figure-1, fig.cap="**Figure 1:** Spatial distribution of Airbnb listings in Los Angeles County by room type.", fig.width=14, fig.height=8}
airbnb_entire <- airbnb_sf %>% filter(room_type == "Entire home/apt")
airbnb_other <- airbnb_sf %>% filter(room_type %in% c("Hotel room", "Private room", "Shared room"))
tmap_mode("plot")

# Helper function for main and inset maps
make_panel <- function(data, color, title) {
  main <- tm_shape(census_tracts_sf, bbox=mainland_bbox) + tm_borders(col="grey70", lwd=0.3) +
    tm_shape(data) + tm_dots(fill=color, size=0.05, fill_alpha=0.5) +
    tm_title(title, fontface="bold", size=1.2) +
    tm_scalebar(position=c("left","bottom"), width=15) +
    tm_compass(type="arrow", position=c("right","top"), size=2.4) + tm_layout(frame=TRUE)
  inset <- tm_shape(census_tracts_sf, bbox=catalina_bbox) + tm_fill(fill="grey95") +
    tm_borders(col="grey70", lwd=0.5) + tm_shape(data) +
    tm_dots(fill=color, size=0.2, fill_alpha=0.7) +
    tm_title("Catalina Island", size=0.7, fontface="bold") +
    tm_layout(frame=TRUE, frame.lwd=2, bg.color="white")
  list(main=main, inset=inset)
}

p1 <- make_panel(airbnb_entire, "darkblue", "Entire Home/Apartment")
p2 <- make_panel(airbnb_other, "darkred", "Hotel / Private / Shared Room")

grid.newpage()
pushViewport(viewport(layout = grid.layout(1, 2)))
for(i in 1:2) {
  p <- if(i==1) p1 else p2
  pushViewport(viewport(layout.pos.col = i))
  print(p$main, vp = viewport(x=0.5, y=0.5, width=0.95, height=0.95))
  print(p$inset, vp = viewport(x=0.78, y=0.17, width=0.22, height=0.28))
  popViewport()
}
```

# Mean Airbnb Prices by Census Tract
[Your existing description text here]

```{r figure-2, fig.cap="**Figure 2:** Mean Airbnb prices by census tract."}
tract_prices <- airbnb_sf %>% st_join(census_tracts_sf) %>% st_drop_geometry() %>%
  group_by(GEOID) %>% summarise(mean_price = mean(price, na.rm=TRUE), .groups='drop')
tracts_with_prices <- census_tracts_sf %>% left_join(tract_prices, by="GEOID")

all_highlight <- tracts_with_prices %>% filter(!is.na(mean_price)) %>%
  mutate(price_rank = rank(-mean_price, ties.method="first")) %>%
  filter(price_rank <= 3 | price_rank >= (max(price_rank) - 2)) %>%
  mutate(type = ifelse(price_rank <= 3, "Highest", "Lowest"),
         label = case_when(price_rank == 1 ~ "1st Highest", price_rank == 2 ~ "2nd Highest",
                          price_rank == 3 ~ "3rd Highest", price_rank == max(price_rank) ~ "1st Lowest",
                          price_rank == max(price_rank)-1 ~ "2nd Lowest", TRUE ~ "3rd Lowest")) %>%
  st_centroid()

highest_tracts <- all_highlight %>% filter(type=="Highest") %>% mutate(label=factor(label, levels=c("1st Highest","2nd Highest","3rd Highest")))
lowest_tracts <- all_highlight %>% filter(type=="Lowest") %>% mutate(label=factor(label, levels=c("1st Lowest","2nd Lowest","3rd Lowest")))

main_choropleth <- tm_shape(tracts_with_prices, bbox=mainland_bbox) +
  tm_fill(fill="mean_price", fill.scale=tm_scale_continuous(values="YlOrRd"), fill.legend=tm_legend(title="Mean Price ($)")) +
  tm_borders(col="grey70", lwd=0.2) +
  tm_shape(highest_tracts) + tm_symbols(shape="label", shape.scale=tm_scale_categorical(values=c(24,25,23)), shape.legend=tm_legend(title="Highest Price"), fill="#DAA520", size=0.8, col="black", lwd=1.2) +
  tm_shape(lowest_tracts) + tm_symbols(shape="label", shape.scale=tm_scale_categorical(values=c(21,22,8)), shape.legend=tm_legend(title="Lowest Price"), fill="#ee1616", size=0.8, col="black", lwd=1.2) +
  tm_title("Mean Airbnb Price by Census Tract", fontface="bold", size=1.2) +
  tm_compass(type="arrow", position=c("right","top"), size=2.4) +
  tm_scalebar(position=c("left","bottom"), width=15) + tm_layout(frame=TRUE, legend.outside=TRUE, legend.outside.position="right")

inset_choropleth <- tm_shape(tracts_with_prices, bbox=catalina_bbox) +
  tm_fill(fill="mean_price", fill.scale=tm_scale_continuous(values="YlOrRd"), fill.legend=NULL) +
  tm_borders(col="grey70", lwd=0.3) + tm_title("Catalina Island", size=1.0, fontface="bold") +
  tm_layout(frame=TRUE, frame.lwd=2, bg.color="white", legend.show=FALSE)

grid.newpage()
print(main_choropleth, vp=viewport(x=0.5, y=0.5, width=1, height=1))
print(inset_choropleth, vp=viewport(x=0.87, y=0.145, width=0.25, height=0.25))
```

### Narrative
Figure 1 shows higher concentration of entire homes and apartments in downtown Los Angeles compared to hotels, private rooms, and shared accommodations. High-value rentals mainly cluster in coastal areas like Santa Monica, Venice, and the affluent hills of Hollywood and Beverly Hills, which attract many tourists. Conversely, private and shared rooms are more evenly distributed, indicating that hosts are more likely to rent out spare rooms rather than entire properties. Typically, regions with high tourism demand show more rentals, while vacant zones suggest residential areas with short-term rental restrictions or limited urban development. In Figure 2, a clear premium exists for coastal regions, with many dark brown patches along the coastline (Malibu, Santa Monica) and in the northern hills. An east-west divide is visible, with the western side displaying many more dark areas than the more affordable eastern side. The highest prices are in the Santa Monica mountains and Malibu, likely reflecting luxury rentals, while the lowest are in densely populated urban areas. For the colour mapping, I used the natural breaks method to ensure minimal variance within classes and maximum variance between classes, which benefits unevenly distributed data. Removing outliers has made lower-cost differences more apparent, improving the map's clarity and visual impact. The yellow-to-red palette intuitively associates red with higher prices. Using gold to highlight the top three most expensive and another colour for the bottom three enhances clarity. The high density of entire homes could pressure the long-term housing market.

# Question 3: Mapping and Data Visualisation

```{r figure-3-data}
renter_data <- get_acs(state="CA", county="Los Angeles", geography="tract",
  variables=c(total_units="B25003_001", renter_occupied="B25003_003"),
  geometry=FALSE, year=2023, output="wide") %>%
  mutate(pct_renter = (renter_occupiedE / total_unitsE) * 100) %>% select(GEOID, pct_renter)

renter_sf <- census_tracts_sf %>% left_join(renter_data, by="GEOID")
Median_income_sf <- census_tracts_sf %>% left_join(census_data %>% select(GEOID, Median_income=B19013_001E), by="GEOID")
```

```{r figure-3, fig.cap="**Figure 3:** Socio-economic characteristics of Los Angeles County census tracts.", fig.width=14, fig.height=9}
tmap_mode("plot")

make_socio_panel <- function(data, var, palette, legend_title, panel_title) {
  main <- tm_shape(data, bbox=mainland_bbox) +
    tm_polygons(fill=var, fill.scale=tm_scale_continuous(values=palette),
                fill.legend=tm_legend(title=legend_title, orientation="landscape"), col="white", lwd=0.1) +
    tm_title(panel_title, fontface="bold", size=1.2) +
    tm_compass(type="arrow", position=c("right","top"), size=1.5) +
    tm_scalebar(position=c("right","bottom"), width=10) +
    tm_layout(frame=TRUE, legend.outside=TRUE, legend.outside.position="bottom", legend.outside.size=0.2, inner.margins=c(0.02,0.02,0.02,0.02))
  inset <- tm_shape(data, bbox=catalina_bbox) +
    tm_polygons(fill=var, fill.scale=tm_scale_continuous(values=palette), fill.legend=tm_legend(show=FALSE), col="white", lwd=0.3) +
    tm_title("Catalina Is.", size=0.6, fontface="bold") + tm_layout(frame=TRUE, frame.lwd=1, bg.color="white")
  list(main=main, inset=inset)
}

p_renter <- make_socio_panel(renter_sf, "pct_renter", "YlOrRd", "Percentage Renters (%)", "A: Renter Occupancy")
p_income <- make_socio_panel(Median_income_sf, "Median_income", "GnBu", "Median Income ($)", "B: Median Household Income")

grid.newpage()
pushViewport(viewport(layout=grid.layout(1,2)))
for(i in 1:2) {
  p <- if(i==1) p_renter else p_income
  pushViewport(viewport(layout.pos.col=i))
  print(p$main, vp=viewport(x=0.5, y=0.5, width=0.98, height=0.98))
  print(p$inset, vp=viewport(x=0.78, y=0.25, width=0.22, height=0.28))
  popViewport()
}
```

## Narrative
Following Wachsmuth and Weisler's (2018) rent gap framework, I chose the percentage of renter-occupied units and median household income as key socioeconomic indicators. Renter occupancy was calculated as the percentage of renter-occupied housing units relative to total occupied housing units for each census tract. This indicates areas vulnerable to rental conversion and relates to income patterns shaping Airbnb’s spatial distribution. Together, these indicators highlight the dynamics of gentrification and the role of tourism economies in driving market expansion. The gap between actual rent (capitalised) and the unrealised potential of short-term rentals is a crucial factor accelerating gentrification and displacing low-income residents. Using income helps to distinguish tourist-serving areas from residential zones. Renter occupancy data was collected from the ACS via tidycensus (variable B25003). These demonstrate the relationship between rental rates and income, with low-income areas having a higher percentage of rentals, making them more susceptible to gentrification. This can be observed on the map, showing high renter occupancy in central/downtown LA, while it is lower in the suburbs. There is a clear inverse relationship between areas such as high-income wealth corridors like Malibu, Santa Monica, San Fernando, and Hollywood, contrasted with lower-income neighbourhoods such as Huntington Park and Compton. This inverse relationship between wealth and renting leaves LA’s low-income residents vulnerable, with some areas experiencing housing loss while others primarily host tourists. My choice of colour highlights this: The YLOrRD (yellow-orange-red) scheme for renter occupancy and GNBu for income were selected for their association with intensity and monetary values respectively, with the legends being positioned horizontally to allow space for the map while remaining colour-blind accessible. A continuous colour scale was employed to preserve the full variance in the data, avoiding any information loss or skew that might obscure neighbourhood-level variance.

# Question 4: Bivariate Analysis

```{r figure-4, fig.cap="**Figure 4:** Bivariate choropleth map examining the relationship between Airbnb prices and renter occupancy.", fig.width=10, fig.height=10}
adjusted_summary_sf <- st_join(renter_sf, airbnb_sf, join=st_intersects) %>%
  mutate(Price = log(price), `% That Rent` = pct_renter) %>%
  select(GEOID, Price, `% That Rent`, geom) %>% st_as_sf()

tm_shape(adjusted_summary_sf, bbox=mainland_bbox) +
  tm_polygons(fill=tm_vars(c("Price", "% That Rent"), multivariate=TRUE, animate=FALSE),
              fill.scale=tm_scale_bivariate(values="purplegold"), fill.chart=tm_chart_heatmap()) +
  tm_title("Bivariate Map: Ln House Price and Percentage Renters", fontface="bold", size=1.2) +
  tm_compass(type="arrow", position=c("right","top"), size=1.5) +
  tm_scalebar(position=c("left","bottom"), width=15) +
  tm_layout(frame=TRUE, legend.outside=TRUE, legend.outside.position="bottom", legend.outside.size=0.2, inner.margins=c(0.02,0.02,0.02,0.02))
```

## Narrative
Figure 4 displays the natural logarithm of house prices alongside the percentage of renters across Los Angeles County. Using the natural log enables us to model nonlinear relationships linearly, aiding in normalising skewed data. The map shows both variables simultaneously, revealing spatial patterns and helping us determine whether high Airbnb prices correspond with areas of high renter populations. This informs whether Airbnb exploitation occurs in rental markets or mainly serves wealthy tourist zones. The map illustrates mean Airbnb listing prices (log-transformed and aggregated at the census tract level) combined with renter data from the ACS, using a purple–gold colour scheme—purple for high renters/low prices, yellow/gold for low renters/high prices, dark gold for high renters/high prices, and light purple for low on both. Dark gold areas indicate displacement hotspots, where rents are driven by short-term tourism rentals rather than residents. This suggests landlords profit from short-term rentals, and the property market mainly targets asset holding rather than residential use—highlighting the rent gap phenomenon. Koreantown emerges as a key displacement hotspot, situated near Hollywood, downtown LA, Dodger Stadium, and the airport, with easy transit access. Areas in the pure gold zone (high prices, low rent), such as Brentwood, are likely second-home investments serving affluent tourists, with low displacement risk due to fewer rental residents. Conversely, areas with many renters and low prices could become future short-term rental hotspots. Horn and Merante (2017) found that a 1% increase in Airbnb rentals can raise asking rents by 0.4%, illustrating how Airbnb can amplify neighbourhood rent levels and reduce long-term housing supply. Addressing high rental populations and elevated Airbnb prices requires targeted regulation to prevent houses from being purchased solely as assets, thereby releasing some homes for residents, lowering prices, and improving affordability (Gurran and Phibbs, 2017). The analysis highlights distinct Airbnb geographies: gentrification zones where high prices intersect with rental-heavy neighbourhoods (Hollywood, West LA), pure tourism zones catering to wealthy visitors (coastal corridor), and areas vulnerable to displacement. This inverse spatial pattern echoes Figure 3, demonstrating how economic inequality influences Airbnb's distribution.

# Question 5: Restaurant Density Analysis with OSM
[Your existing description text here]

```{r figure-5-data, cache=TRUE}
test_bbox <- c(-119.473572, 33.493307, -117.051086, 34.633208)
q <- opq(bbox=test_bbox) %>% add_osm_feature(key="amenity", value="restaurant") %>% osmdata_sf()
restaurants <- q$osm_points %>% select(name, geometry) %>% filter(!is.na(geometry)) %>% st_coordinates()
```

```{r figure-5, fig.cap="**Figure 5:** Kernel density estimation of restaurant locations.", fig.width=10, fig.height=8}
restaurants_df <- data.frame(restaurants) %>% st_as_sf(coords=c("X","Y"), crs=4326) %>% st_transform(32611)
restaurants_coords <- st_coordinates(restaurants_df)

ggplot() +
  stat_density_2d_filled(data=as.data.frame(restaurants_coords), aes(x=X, y=Y), contour_var="density", bins=15, alpha=0.9) +
  geom_sf(data=neighbourhoods_sf, fill=NA, colour="white", linewidth=0.2) +
  scale_fill_viridis_d(option="inferno", name="Density", guide=guide_legend(reverse=TRUE)) +
  coord_sf() + labs(title="Restaurant Density", x=NULL, y=NULL) +
  theme_void(base_size=12) +
  theme(legend.position="right", plot.title=element_text(face="bold", hjust=0.5, color="white"),
        plot.background=element_rect(fill="black", colour=NA), legend.text=element_text(colour="white"), legend.title=element_text(colour="white"))
```

# Proximity Analysis: Airbnbs Near Restaurants
Figure 5 maps restaurant density across Los Angeles County using OpenStreetMap data. The number of restaurants correlates with the area's popularity, often indicating higher rental and purchase prices. It represents tourism infrastructure and neighbourhood vibrancy, with density patterns revealing commercial centres, gentrification trends, and areas with higher disposable income. I applied kernel density estimation with a 3km bandwidth to identify hotspots. The main hotspots are located in downtown LA, with many other restaurants in areas such as West Hollywood and along the coast in Santa Monica, while peripheral residential zones show notable gaps. There is a strong correlation between Airbnb rentals and the number of restaurants. Highlighting the positive feedback loop of short-term rentals and the restaurant ecosystem, they share a mutually beneficial relationship. The high density of Airbnb listings results from the area's amenity-rich character. 

```{r figure-6, fig.cap="**Figure 6:** Proximity analysis showing Airbnb listings within 200m of restaurants in Hollywood.", fig.width=10, fig.height=8}
chosen_neighbourhood <- "Hollywood"
target_sf <- neighbourhoods_sf %>% filter(neighbourhood == chosen_neighbourhood)
restaurants_sf <- q$osm_points %>% select(name, geometry) %>% filter(!is.na(geometry)) %>% st_as_sf() %>% st_transform(32611)
target_restaurants <- restaurants_sf %>% st_filter(target_sf)
restaurant_buffers <- st_buffer(target_restaurants, dist=200)
buffer_union <- st_union(restaurant_buffers)
target_airbnbs <- airbnb_sf %>% st_filter(target_sf)
airbnbs_near <- target_airbnbs %>% filter(lengths(st_intersects(., restaurant_buffers)) > 0)

ggplot() +
  geom_sf(data=target_sf, fill="#f8f9fa", color="#495057", linewidth=0.5) +
  geom_sf(data=buffer_union, aes(fill="Within 200m"), alpha=0.2, color=NA) +
  geom_sf(data=target_airbnbs, aes(color="Outside 200m"), shape=16, size=1, alpha=0.4) +
  geom_sf(data=airbnbs_near, aes(color="Airbnb (within 200m)"), shape=16, size=2) +
  geom_sf(data=target_restaurants, aes(color="Restaurant"), shape=17, size=2) +
  annotation_scale(location="br", width_hint=0.15, style="ticks", line_width=0.5, height=unit(0.15,"cm"), pad_x=unit(0.5,"cm"), pad_y=unit(0.5,"cm")) +
  annotation_north_arrow(location="tr", which_north="true", height=unit(1,"cm"), width=unit(1,"cm"), pad_x=unit(0.5,"cm"), pad_y=unit(0.5,"cm"), style=north_arrow_fancy_orienteering) +
  scale_fill_manual(name=NULL, values=c("Within 200m"="#e63946"), guide=guide_legend(order=1, override.aes=list(alpha=0.2))) +
  scale_color_manual(name=NULL, values=c("Outside 200m"="grey70", "Airbnb (within 200m)"="#1d3557", "Restaurant"="#e63946"),
                     guide=guide_legend(order=2, override.aes=list(shape=c(16,16,17), size=c(2,3,3), alpha=1))) +
  labs(title=paste("Airbnb Listings within 200m of Restaurants in", chosen_neighbourhood),
       subtitle=paste0(nrow(airbnbs_near), " of ", nrow(target_airbnbs), " listings within walking distance of ", nrow(target_restaurants), " restaurants"),
       caption="Data: Inside Airbnb & OpenStreetMap | CRS: EPSG 32611") +
  theme_void(base_size=11) +
  theme(plot.title=element_text(face="bold", hjust=0.5, size=13), plot.subtitle=element_text(hjust=0.5, color="grey40", margin=margin(t=5,b=10)),
        plot.caption=element_text(hjust=0.5, color="grey50", size=8), plot.margin=margin(15,15,15,15), legend.position="bottom", legend.box.margin=margin(t=10))
```

# Narrative
Figure 6 shows Airbnb listings within a 200m radius of restaurants in the neighbourhood of Hollywood. I chose Hollywood for its amenities, high Airbnb density, and tourist appeal. I created a 200m buffer around each restaurant, roughly representing a comfortable walking distance to these amenities. Of the 1320 listings, 758 (57%) were within a 200m radius of 367 restaurants, with restaurant clustering attracting tourists along streets such as Sunset and Hollywood Boulevard, while outer residential streets offer fewer options. This concentration highlights Airbnb hosts strategically located near dining amenities and within popular tourist areas, showing the correlation between amenity-dense neighbourhoods like Hollywood and West LA, demonstrating that dining infrastructure contributes to rental premiums. These properties offer accommodation at a premium, reinforcing a tourism-oriented geography. This ‘consumer city’ framework explains how clustering can induce and prioritise the provision of consumption amenities (Glaeser et al., 2001). Restaurant presence and access to dining amenities and retail are often indicators of, and drivers of, gentrification, attracting tourism and displacing residential services (Lloyd, 2002; Zukin et al., 2009). The effect of increased tourism and consumption of amenities can often distract from attractiveness for residents wishing to buy and live, as exemplified by Notting Hill gentrification, where making it a tourist attraction has reduced its desirability for residents (Parker, 2025).

# Part B - Option 1: Point Pattern Analysis
[Your existing description text here]

```{r figure-7-8-combined, fig.cap="**Figure 7:** Kernel density estimation using point pattern analysis (2km bandwidth).", fig.width=12, fig.height=10, fig.align='center'}
BA_boundary <- st_union(neighbourhoods_sf)
BA_owin_m <- as.owin(BA_boundary)
coords <- st_coordinates(airbnb_sf)
listings_ppp <- ppp(x=coords[,1], y=coords[,2], window=BA_owin_m)
listings_ppp <- rescale(listings_ppp, 1000)
BA_owin <- rescale(BA_owin_m, 1000)
marks(listings_ppp) <- NULL
K1 <- density.ppp(listings_ppp, sigma=2)

plot(K1, main="Kernel Density of Airbnb Listings", las=1)
contour(K1, add=TRUE)
plot(BA_owin, add=TRUE)
```

# Narrative
[Your existing narrative text here]

# Figure 8: Transit Oriented Displacement
[Your existing description text here]

```{r figure-8, fig.cap="**Figure 8:** Airbnb clustering along the Red/Purple Line.", fig.width=12, fig.height=10}
# Download Metro data
url_metro <- "https://developer.metro.net/wp-content/uploads/2019/10/802_Red_Purple_Track_0316.zip"
url_station <- "https://developer.metro.net/wp-content/uploads/2019/10/802_805_RedPurple_Stations_0316.zip"

for(u in list(list(url_metro, "red-purple-line"), list(url_station, "red-purple-stations"))) {
  if(!file.exists(file.path(ddir, u[[2]]))) {
    download.file(url=u[[1]], destfile=file.path(ddir, paste0(u[[2]], ".zip")))
    unzip(file.path(ddir, paste0(u[[2]], ".zip")), exdir=file.path(ddir, u[[2]]))
  }
}

red_purple_line_sf <- st_read(file.path(ddir, "red-purple-line/802_805_Track_0316.shp")) %>% st_transform(32611)
station <- st_read(file.path(ddir, "red-purple-stations/RedPurpleLine0316.shp")) %>% select(STATION, geometry) %>% st_transform(32611)
station_buffers <- st_buffer(station, dist=400)

station_counts <- st_join(airbnb_sf, station_buffers, left=FALSE) %>% st_drop_geometry() %>%
  group_by(STATION) %>% summarise(n_airbnb=n()) %>% ungroup()
station_with_counts <- station %>% left_join(station_counts, by="STATION") %>% mutate(n_airbnb=replace_na(n_airbnb, 0))

redpurple_corridor <- st_buffer(red_purple_line_sf, dist=1000) %>% st_union()
vulnerable_tracts_redpurple <- renter_sf %>% filter(pct_renter > 50) %>% st_filter(redpurple_corridor, .predicate=st_intersects)
key_neighborhoods <- neighbourhoods_sf %>% filter(neighbourhood %in% c("Hollywood","Koreatown","Downtown","West Hollywood","Silver Lake","Echo Park","Venice","Santa Monica","Beverly Hills","Westwood","Mid-City"))

fig8_main <- ggplot() +
  geom_sf(data=vulnerable_tracts_redpurple, aes(fill=pct_renter), color="grey80", alpha=0.5) +
  scale_fill_distiller(palette="YlOrRd", direction=1, name="% Renter\nOccupied", limits=c(50,100)) +
  geom_sf(data=key_neighborhoods, fill=NA, color="grey30", linewidth=0.8) +
  geom_sf(data=station_buffers, fill=NA, color="#E31837", linetype="dashed", linewidth=0.5, alpha=0.6) +
  geom_sf(data=red_purple_line_sf, color="#E31837", linewidth=1.5) +
  geom_sf(data=airbnb_sf %>% st_filter(station_buffers), color="gold", size=0.5, alpha=0.4) +
  geom_sf(data=station_with_counts, aes(size=n_airbnb), color="darkred", alpha=0.8, shape=16) +
  scale_size_continuous(name="Airbnb\nListings\nwithin 400m", range=c(2,8), breaks=c(0,100,200,300,400,500)) +
  annotation_scale(location="br", width_hint=0.15, style="ticks", line_width=0.5, height=unit(0.15,"cm"), pad_x=unit(0.5,"cm"), pad_y=unit(0.5,"cm")) +
  annotation_north_arrow(location="tr", which_north="true", height=unit(1,"cm"), width=unit(1,"cm"), pad_x=unit(0.5,"cm"), pad_y=unit(0.5,"cm"), style=north_arrow_fancy_orienteering) +
  theme_void() +
  theme(legend.position="right", legend.background=element_rect(fill="white", color="grey50"),
        plot.title=element_text(face="bold", hjust=0.5, size=13), plot.subtitle=element_text(hjust=0.5, color="grey40", margin=margin(t=5,b=10)),
        plot.caption=element_text(hjust=0.5, color="grey50", size=8), plot.margin=margin(15,15,15,15)) +
  labs(title="Airbnb Clustering Along the Red/Purple Line", subtitle="Transit-oriented displacement in Hollywood, Koreatown, and Downtown",
       caption="Data: Inside Airbnb, LA Metro, ACS 2019-2023 | CRS: EPSG 32611")

inset_overview <- ggplot() +
  geom_sf(data=census_tracts_sf, fill="grey90", color="grey80", linewidth=0.1) +
  geom_sf(data=red_purple_line_sf, color="#E31837", linewidth=2) +
  geom_sf(data=vulnerable_tracts_redpurple, fill="#E31837", alpha=0.3, color=NA) +
  theme_void() + theme(panel.border=element_rect(color="black", fill=NA, linewidth=1), plot.background=element_rect(fill="white", color=NA))

grid.newpage()
print(fig8_main, vp=viewport(x=0.5, y=0.5, width=1, height=1))
print(inset_overview, vp=viewport(x=0.15, y=0.22, width=0.25, height=0.25))
```

## Narrative
[Your existing narrative text here]

## Conclusion
[Your existing conclusion text here]
